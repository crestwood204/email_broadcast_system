<div>
  <span style="float: right;">
    <form id="search-bar-form" action="{{endpoint}}" class="form-inline my-2 my-lg-0">
      <input id="search" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" value="{{search}}">
      <button id="search-btn" class="btn yellow-button my-2 my-sm-0 form-control" type="submit">&nbsp<i class="fa fa-search"></i>&nbsp</button>
      <span style="padding: 4px;"> </span>
      <a href="/new_request"><button class="btn yellow-button my-2 my-sm-0" type="button"><i class="fa fa-plus"></i></button></a>
    </form>
  </span>
  {{#if pending}}
    <h1> Pending Broadcasts </h1>
  {{else}}
    <h1> Broadcasts </h1>
  {{/if}}
  <table class="table">
      <thead>
          <tr>
              <th scope="col">#</th>
              <th scope="col">Username</th>
              <th scope="col">To</th>
              <th scope="col">Subject</th>
              <th scope="col">Date</th>
          </tr>
      </thead>
      <tbody>
          {{#each broadcasts}}
              {{#if ../pending}}
                <tr class="clickable-row" data-toggle="collapse" data-target="#decision-{{this._id}}">
              {{else}}
                <tr class="clickable-row" data-href="/broadcast?id={{this._id}}">
              {{/if}}
                  <th scope="row">{{math @index "+" ../startIndex}}</th>
                  <td style="min-width: 20%;">{{this.createdBy.username}}</td>
                  <td style="min-width: 20%;">{{this.to}}</td>
                  <td style="width: 50%;">{{this.subjectString}}</td>
                  <td style="width: 15%;">{{this.dateString}}</td>
              </tr>
              {{#if ../pending}}
                <tr>
                    <td class="blank-row"> </td>
                    <td class="blank-row details" colspan="5">
                        <div id="decision-{{this._id}}" class="collapse out">
                            <div> To: {{this.to}} </div>
                            <div> From: {{this.from}} </div>
                            <div> Subject: {{this.subject}} </div>
                            <div class="border-top" style="padding: 10px 0 10px 0;"> {{this.body}} </div>
                            <div class="border-top" style="padding-top: 10px;">
                              {{#each this.attachments}}
                                <span style="display: inline-block; margin-right: 10px;">
                                  <a href="{{substring this.path 6 this.path.length}}" style="color: green; display: flex; flex-direction: column; align-items: center; justify-content: center;" download>
                                    <div style="flex: start;"><i class="fa fa-file"></i></div>
                                    <div style="color: black; flex: end;">{{this.originalname}}</div>
                                  </a>
                                </span>
                              {{/each}}
                            </div>
                            <div style="float: right; cursor: default;">
                              <btn id="approve-{{this._id}}" class="approve-btn btn-sm btn-success" style="cursor: default;">Approved</btn>
                              <btn id="reject-{{this._id}}" class="reject-btn btn-sm btn-danger" style="cursor: default;">Rejected</btn>
                            </div>
                        </div>
                    </td>
                </tr>
              {{/if}}
          {{/each}}
      </tbody>
  </table>
  {{#if noBroadcasts}}
    {{#if pending}}
      <h3> No Pending Broadcasts </h3>
    {{else}}
      <h3> No Broadcasts Have Been Sent </h3>
    {{/if}}
  {{/if}}
  {{#unless noBroadcasts}}
    {{#if noResults}}
      <h4> No Results Found</h4>
    {{/if}}
  {{/unless}}
  <div class="d-flex justify-content-end">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <!-- Back 3 -->
        {{#compare page 4 opeartor=">="}}
        <li class="page-item">
        {{/compare}}
        {{#compare page 4 operator="<"}}
        <li class="page-item disabled">
        {{/compare}}
          <a class="page-link" href="{{endpoint}}page={{math page "-" 3}}&search={{search}}" aria-label="Previous">
            <span aria-hidden="true"><i class="fa fa-angle-double-left"></i> Skip 3</span>
            <span class="sr-only">Back 3</span>
          </a>
        </li>

        <!-- Back 1 -->
        {{#compare page 1 operator="!=="}}
        <li class="page-item">
        {{/compare}}
        {{#compare page 1}}
        <li class="page-item disabled">
        {{/compare}}
          <a class="page-link" href="{{endpoint}}page={{math page "-" 1}}&search={{search}}" aria-label="Previous">
            <span aria-hidden="true"><i class="fa fa-angle-left"></i></span>
            <span class="sr-only">Previous</span>
          </a>
        </li>

        <!-- Current page -->
        <li class="page-item">
          <a class="page-link" href="{{endpoint}}page={{page}}&search={{search}}">
            <b>{{page}}</b>
          </a>
        </li>

        <!-- Next page -->
        {{#compare page last operator="!=="}}
        <li class="page-item">
        {{/compare}}
        {{#compare page last}}
        <li class="page-item disabled">
        {{/compare}}
        <a class="page-link" href="{{endpoint}}page={{math page "+" 1}}&search={{search}}" aria-label="Next">
          <span aria-hidden="true"><i class="fa fa-angle-right"></i></span>
          <span class="sr-only">Next</span>
        </a>
      </li>

        <!-- Skip 3 -->
        {{#compare page threeBeforeLast operator="<"}}
        <li class="page-item">
        {{/compare}}
        {{#compare page threeBeforeLast operator=">="}}
        <li class="page-item disabled">
        {{/compare}}
          <a class="page-link" href="{{endpoint}}page={{math page "+" 3}}&search={{search}}" aria-label="Previous">
            <span aria-hidden="true">Skip 3 <i class="fa fa-angle-double-right"></i></span>
            <span class="sr-only">Skip 3</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  {{#if pending}}
    <script src="/js/collapsible_table.js"></script>
    <script src="/js/pending_requests.js"></script>
  {{else}}
    <script src="/js/home.js"></script>
  {{/if}}
  <script src="/js/table_search.js"></script>
</div>
